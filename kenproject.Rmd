---
title: "STAT 447 project"
author: "Ken Mawer"
date: "2023-04-05"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}
library(tidyverse)
library(maptree)
library(randomForest)
library(caret)
```

```{r get_data, include = FALSE}
# Get datasets
train <- read_csv("Data/Meta/meta_annotation_info_train.csv")
holdo <- read_csv("Data/Meta/meta_annotation_info_test.csv")

# Remove response variables and other irrelevant variables
process <- function(dataset) {
  dplyr::select(dataset,-Malignancy,-Malignancy_median_high,-Malignancy_median,-Malignancy_mean,-Malignancy_mode,-Malignancy_entropy,-Patient_id, -starts_with("Internal")) %>%
    mutate(Is_cancer = as_factor(Is_cancer))
}

t <- process(train)
h <- process(holdo)
```

```{r analysis, include=FALSE}
# Exploratory data analysis
summary(train)
```

```{r randomforest, echo=FALSE}
set.seed(123)
tr <- tree::tree(Is_cancer~.,data=t)
draw.tree(tr)

my_rf <- randomForest(Is_cancer~.,data=t)
my_cm <- my_rf$confusion
my_cv <- rfcv(dplyr::select(t,-Is_cancer),t$Is_cancer)
# set n.var to 12 to reduce overfitting

tuneRF(dplyr::select(t,-Is_cancer),t$Is_cancer)

preds <- predict(my_rf,h)

confusionMatrix(predict(randomForest(Is_cancer~.,data=t),h),h$Is_cancer)
confusionMatrix(predict(randomForest(Is_cancer~.,data=t,mtry = 12),h), h$Is_cancer)

t_error_ct <- function(rf) {
  cm <- rf$confusion
  sum(cm[1:4,1:4]) - sum(diag(cm))
}

te <- c()
for (i in c(1,3,6,11,22,44)) {
  tr_error <- t_error_ct(randomForest(Is_cancer~.,data=t,mtry = i))
  te <- c(te,tr_error)
}
```

```{r}
plot(my_cv$n.var, my_cv$error.cv)
```

```{r interval_score,echo=FALSE}

```